<!-- manage.component-maquinas.html -->
<div class="header bg-gradient-danger pb-8 pt-5 pt-md-8">
</div>
<!-- Page content -->
<div class="container-fluid mt--7">
  <!-- Table -->
  <div class="row">
    <div class="col">
      <div class="card shadow">
        <div class="card-header bg-transparent">
          <h3 class="mb-0" *ngIf="mode==1">Detalle de Máquina</h3>
          <h3 class="mb-0" *ngIf="mode==2">Crear Máquina</h3>
          <h3 class="mb-0" *ngIf="mode==3">Actualizar Máquina</h3>
        </div>
        <div class="card-body">
          <form [formGroup]="maquinaForm">
            <div class="row mb-3" *ngIf="mode===1">
              <div class="col-3">ID</div>
              <div class="col-9">
                <input type="number" class="form-control" [value]="maquina.id" disabled>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-3">Especialidad</div>
              <div class="col-9">
                <input type="text" class="form-control" formControlName="especialidad"
                  [ngClass]="{'is-invalid': maquinaForm.get('especialidad')?.invalid && maquinaForm.get('especialidad')?.touched}">
                <div class="invalid-feedback" *ngIf="maquinaForm.get('especialidad')?.touched">
                  <div *ngIf="maquinaForm.get('especialidad')?.errors?.['required']">La especialidad es requerida</div>
                  <div *ngIf="maquinaForm.get('especialidad')?.errors?.['minlength']">La especialidad debe tener al menos 3 caracteres</div>
                  <div *ngIf="maquinaForm.get('especialidad')?.errors?.['maxlength']">La especialidad no debe exceder 50 caracteres</div>
                </div>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-3">Marca</div>
              <div class="col-9">
                <input type="text" class="form-control" formControlName="marca"
                  [ngClass]="{'is-invalid': maquinaForm.get('marca')?.invalid && maquinaForm.get('marca')?.touched}">
                <div class="invalid-feedback" *ngIf="maquinaForm.get('marca')?.touched">
                  <div *ngIf="maquinaForm.get('marca')?.errors?.['required']">La marca es requerida</div>
                  <div *ngIf="maquinaForm.get('marca')?.errors?.['minlength']">La marca debe tener al menos 2 caracteres</div>
                  <div *ngIf="maquinaForm.get('marca')?.errors?.['maxlength']">La marca no debe exceder 30 caracteres</div>
                </div>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-3">Modelo</div>
              <div class="col-9">
                <input type="text" class="form-control" formControlName="modelo"
                  [ngClass]="{'is-invalid': maquinaForm.get('modelo')?.invalid && maquinaForm.get('modelo')?.touched}">
                <div class="invalid-feedback" *ngIf="maquinaForm.get('modelo')?.touched">
                  <div *ngIf="maquinaForm.get('modelo')?.errors?.['required']">El modelo es requerido</div>
                  <div *ngIf="maquinaForm.get('modelo')?.errors?.['minlength']">El modelo debe tener al menos 2 caracteres</div>
                  <div *ngIf="maquinaForm.get('modelo')?.errors?.['maxlength']">El modelo no debe exceder 30 caracteres</div>
                </div>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-3">Estado</div>
              <div class="col-9">
                <select class="form-control" formControlName="estado"
                  [ngClass]="{'is-invalid': maquinaForm.get('estado')?.invalid && maquinaForm.get('estado')?.touched}">
                  <option value="">Seleccione un estado</option>
                  <option *ngFor="let estado of estadosValidos" [value]="estado">{{estado}}</option>
                </select>
                <div class="invalid-feedback" *ngIf="maquinaForm.get('estado')?.touched">
                  <div *ngIf="maquinaForm.get('estado')?.errors?.['required']">El estado es requerido</div>
                  <div *ngIf="maquinaForm.get('estado')?.errors?.['pattern']">Estado inválido</div>
                </div>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-3">Ubicación</div>
              <div class="col-9">
                <input type="text" class="form-control" formControlName="ubicacion"
                  [ngClass]="{'is-invalid': maquinaForm.get('ubicacion')?.invalid && maquinaForm.get('ubicacion')?.touched}">
                <div class="invalid-feedback" *ngIf="maquinaForm.get('ubicacion')?.touched">
                  <div *ngIf="maquinaForm.get('ubicacion')?.errors?.['required']">La ubicación es requerida</div>
                  <div *ngIf="maquinaForm.get('ubicacion')?.errors?.['minlength']">La ubicación debe tener al menos 5 caracteres</div>
                  <div *ngIf="maquinaForm.get('ubicacion')?.errors?.['maxlength']">La ubicación no debe exceder 100 caracteres</div>
                </div>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-3">Disponibilidad</div>
              <div class="col-9">
                <select class="form-control" formControlName="disponibilidad"
                  [ngClass]="{'is-invalid': maquinaForm.get('disponibilidad')?.invalid && maquinaForm.get('disponibilidad')?.touched}">
                  <option *ngFor="let opcion of disponibilidadOpciones" [value]="opcion.value">{{opcion.label}}</option>
                </select>
                <div class="invalid-feedback" *ngIf="maquinaForm.get('disponibilidad')?.touched && maquinaForm.get('disponibilidad')?.errors?.['required']">
                  La disponibilidad es requerida
                </div>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-3">Fecha de Asignación</div>
              <div class="col-9">
                <input type="date" class="form-control" formControlName="fecha_asignacion">
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-3">Fecha de Retiro</div>
              <div class="col-9">
                <input type="date" class="form-control" formControlName="fecha_retiro"
                  [ngClass]="{'is-invalid': maquinaForm.get('fecha_retiro')?.errors?.['fechaInvalida']}">
                <div class="invalid-feedback" *ngIf="maquinaForm.get('fecha_retiro')?.errors?.['fechaInvalida']">
                  La fecha de retiro debe ser posterior a la fecha de asignación
                </div>
              </div>
            </div>

            <div class="row mt-4">
              <div class="col">
                <button class="btn btn-outline-danger" (click)="back()">
                  <i class="fas fa-chevron-left"></i> Regresar
                </button>
              </div>
              <div class="col text-right">
                <button *ngIf="mode==2" class="btn btn-success" (click)="create()"
                  [disabled]="maquinaForm.invalid">
                  <i class="fas fa-plus"></i> Crear
                </button>
                <button *ngIf="mode==3" class="btn btn-primary" (click)="update()"
                  [disabled]="maquinaForm.invalid">
                  <i class="fas fa-save"></i> Actualizar
                </button>
                <button *ngIf="mode==1" class="btn btn-danger" (click)="delete(maquina.id!)">
                  <i class="fas fa-trash"></i> Eliminar
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
